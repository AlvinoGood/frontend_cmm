
# 0) Stack & Principles

Angular 19 with Tailwind 3.4.18

# 1) Light Theme & Color Palette (tokens)

* **Base:** background `#FFFFFF`, surface `#F9FAFB`, borders `#E5E7EB`.
* **Primary:** `#8D0C28` (deep burgundy red) / text on primary `#FFFFFF`.
* **Secondary / Accent:** `#F4C151` (pastel gold).
* **Neutrals:** use two whites (`#FFFFFF`, `#F9FAFB`) for backgrounds and surfaces.
* **States:** success `#8D0C28` with opacity 0.2 overlay, warning `#F4C151` with darker text, danger = primary (`#8D0C28`) emphasis, info = neutral light border.
* **Typography:** Inter/Manrope, base 14–16px, headings semi-bold.
* **Components:** pill buttons (rounded-2xl, filled primary or outline), soft shadow cards, subtle pastel badges, hover states with opacity variations.

# 2) App Shell (Layout)

* **Header (top):** logo, role switch (if applies), user info (name + email/DNI), profile menu (Profile, Logout).
* **Sidebar (left):** role-based items (filtered by Guard). Include menu search.
* **Content (right):** nested routes; contextual toolbar (search, filters, actions).
* **Footer:** “/medical-center/v1 · JWT · Dynamic PDFs”.

# 3) Routes (ordered map)


* **Guards:** `JwtAuthGuard` (valid token), `RolesGuard` (path by role) (sidebar items by role in left panel):

  * **user:** home, services, payments, medical-card, profile
  * **medical:** home, encounters, appointments, services, payments, patients-served, profile
  * **admin:** home, encounters (read-only), appointments, services (CRUD), payments (audit), users, templates, profile

# 4) Auth UX (login/register)

* **Login (DNI + password):** store JWT + decode `sys_role`, `medical_role`. Token of 5 minutes.
* **Register:** DNI, email, password → default role `user`.
* **Forgot/Reset:** email token flow (clean pastel screens, friendly messages).
* **Expired token:** refresh token.

# 5) Sidebar by Role (short)

* **User:** Home, Services, Payments, Medical Card, Profile.
* **Medical:** Home, Encounters, Appointments, Services, Payments, Patients Served, Profile.
* **Admin:** Home, Encounters, Appointments, Services, Payments, Users, Templates, Profile.

# 6) Views (right panel) – functional & concise

**User**

* **Home:** grid of attended appointment PDFs (view/download). Friendly empty state if none.
* **Services:** table (paginated 10), select one → “Generate ticket” (confirm/back).
* **Payments:** tickets table (pending/paid/expired), view only.
* **Medical Card:** if none → “Request” form (review before submit). If exists → list/see previous.
* **Profile:** DNI/email (view only), change password (secure form).

**Medical**

* **Home:** KPIs (total patients, this month’s visits) + 2 recent PDFs created by them.
* **Encounters:** “Generate” button → specialty-based form (MEOBPS/Dentist) + confirmation step.
* **Appointments:** patient search → view/download PDF (cross-specialty).
* **Services:** read-only, filtered by `medical_role`.
* **Payments:** search by patient → related tickets (view only).
* **Patients Served:** paginated table (10), view only.
* **Profile:** email/role/specialty (view only).

**Admin**

* **Home:** KPIs (users, appointments, tickets, services).
* **Encounters:** global search of encounters (read-only).
* **Appointments:** global table (10 pagination) + search.
* **Services:** CRUD (create/edit/delete).
* **Payments:** audit table + filters.
* **Users:** manage accounts, promote to medical, assign specialty.
* **Templates:** CRUD of `medical_template` and `medical_roles`.
* **Profile:** personal data.

# 7) Reusable Components (clear names)

* **Shell:** `AppHeader`, `AppSidebar`, `ContentArea`, `PageTitle`, `KpiCard`, `DataTable`, `EmptyState`, `ConfirmModal`, `PdfCard`, `SearchInput`, `Pagination`.
* **Forms:** `FormSection`, `FormActions`, `Field.*` (Input, Select, Date, Radio, File).
* **Domain:** `ServiceRow`, `TicketRow`, `EncounterRow`, `TemplateRow`, `UserRow`.

# 8) Data & API (layers)

* **api/client.ts:** axios + interceptors (token, 401→logout).
* **api/hooks/** with **TanStack Query**:

  * `useServices`, `useTickets`, `useMedicalCard`, `useEncounters`, `useAppointments`, `useUsers`, `useTemplates`, etc.
* **Mutations:** `createTicket`, `createEncounter`, `submitMedicalCard`, `updateService`, etc.
* **PDF Downloads:** `GET /pdf/:resource/:id` → open in new tab or `download`.

# 9) UX States (essentials)

* **Pagination 10** default.
* **Search & filters** in Appointments/Payments/Patients Served/Users/Services.
* **Empty states** (soft icon + helpful copy + CTA).
* **Skeleton loaders** (cards/tables).
* **Toasts** (success/error), **confirmation modals** (submit forms, delete service).
* **Preview step** before sending clinical forms and tickets.

# 10) UI Security & Permissions

* Show/hide sidebar items by guard; disable blocked actions (tooltip).
* Validations: DNI numeric ≤ 8, `sex M/F`, blood group (A±/B±/AB±/O±), `amount ≥ 0`.
* Never “Delete” paid tickets; use “Cancel with log” if required.

# 11) Accessibility & i18n

* Strong contrast despite pastels (dark text on light).
* Visible focus, `aria-labels` on icons, keyboard navigation.
* Ready for i18n (centralized strings).

# 13) Development Flow (in order)

1. **Auth** (login/register/forgot/reset) + `AuthGuard`.
2. **App Shell** (header + sidebar + guards per role).
3. **Home** per role with KPIs and empty states.
4. **Services & Tickets** (user + admin CRUD services).
5. **Clinical forms** (Medical: Encounters + confirm modal).
6. **Appointments/Patients Served/Payments** (lists, search, pagination).
7. **Users & Templates** (admin).
8. **PDFs** (view/download) and refine states.
9. **Visual polish** (pastel theme, subtle animations, a11y).
```
