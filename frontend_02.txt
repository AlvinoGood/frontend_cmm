## **Interfaces al ingresar a la aplicacion web**

* **Login (DNI + password):** store JWT + decode `sys_role`, `medical_role`. Token of 5 minutes.
* **Register:** DNI, email, password â†’ default role `user`.
* **Forgot/Reset:** send reset token/link to the userâ€™s email (email token flow; clean pastel screens, friendly messages).
* **Expired token:** refresh token. (logic of authentication)

---

## Sidebar items view by Role (short)

* **User:** Home, Services, Payments, Medical Card, Profile.
* **Medical:** Home, Encounters, Appointments, Services, Payments, Patients Served, Profile.
* **Admin:** Home, Encounters, Appointments, Services, Payments, Users, Templates, Profile.

--- 

## ðŸ‘¤ **User (paciente)**

* **Inicio** â†’ Dashboard simple que pueda ver los PDFs de sus citas atentidas y con la posibilidad de descargar, visualizar.(solo puede ver y descargar)
* **Servicios** â†’ CatÃ¡logo de servicios, una tabla de los servicios existentes, con boton para elegir solo 1 y redirigir inmediatamente a nueva interfaz de "Generar ticket" donde debera confirmar o regresar. 
* **Pagos** â†’ Lista de sus tickets con los estados (pending, paid, expired). (solo puede ver)
* **Tarjeta de sanidad** â†’ con botones de Solicitar/ver su tarjeta de sanidad (certificado). Si boton es "Solicitar" debe generar nueva interfaz de formulario para que rellene sus datos (tabla "medical_card") y envie. Caso contrario el boton es "Ver tarjeta de sanidad" entonces se debe mostrar su tarjeta actual (si no tiene, entonces debe mostrar un mensaje con usted aun no cuenta con tarjeta de sanida) y sus tarjetas anteriores. (puede agregar y  ver)
* **Perfil** â†’ Sus datos personales (DNI, email)(solo puede ver).

---

## ðŸ©º **Medical (mÃ©dico/enfermero/psicÃ³logo/etc.)**

* **Inicio** â†’ Dashboard con resumen Cant. de pacientes atentidos en total, Atenciones durante el mes y los 2 ultimos PDF's recientes generados por el mismo. (esto segun su rol de medico) (solo puede ver)
* **Atenciones** â†’ con boton de "Generar", si el boton es "Generar" entonces se debe redirigir a la interfaz de formulario respecto al medico (correspondiente a la tablas "form_dentist", "form_meobps") para que rellene los datos y envie. (Puede agregar, y ver), Como ultimo paso antes de enviar darle un resumen para confirmar datos correctos y enviar.
* **Servicios** â†’ Ver quÃ© servicios estÃ¡n disponibles para su especialidad. (mostrar en una tabla, solo puede ver)
* **Pagos** â†’ Estado de tickets relacionados al servicios del paciente, para ello contara con un "search"  (solo ver)(la interfaz debe mostrar un search para buscar por el DNI del paciente.
* **Atendidos** â†’ Acceso rÃ¡pido a **sus pacientes atendidos por el doctor** (mostrar una interfaz con tablas de 10 en 10, solo puede ver).
* **Perfil** â†’ Sus datos personales y rol (email, rol, especialidad)(solo puede ver).

---

## ðŸ› ï¸ **Admin**

* **Inicio** â†’ Dashboard con cant de usuarios, cant de citas atendidas, cant de tickets y cant de servicios brindados.
* **Atenciones** â†’ Puede revisar cualquier encuentro. (interfaz de solo vista con un "search" que se debe ingresar el DNI para buscar cualquier paciente)
* **Citas** â†’ Acceso a todos las citas clÃ­nicas atendidas (interfaz con tabla de las citas atendidas, de 10 en 10 y con un search para optimizar la busqueda)
* **Servicios** â†’ Crear, , Ver, Editar y Eliminar servicios.
* **Pagos** â†’ Ver y auditar todos los tickets. (interfaz con tabla de 10 en 10)
* **Usuarios** â†’ Gestionar cuentas (crear, promover a mÃ©dico, asignar especialidad, editar, eliminar).
* **Templates** â†’ poder Agregar nuevas plantillas mÃ©dicas `medical_template`, Especialidades (`medical_roles`)
* **Perfil** â†’ Sus datos personales.

---

Consideraciones
- Listas paginadas (10)
- Los searchs o barras de busqueda, se debe ingresar el DNI. 
- El backend, API's, etc. sera en ingles, mientras que el frontend en la interfaz sera en espaÃ±ol.
- la api que se consumira sera con el nombre de "/medical-center/v1"

---

Folders Structure for frontend:

src/
â””â”€ app/
â”‚   â”œâ”€ core/                         # App-wide singletons & cross-cutting code
â”‚   â”‚  â”œâ”€ services/                  # Global API/auth/session services used across the app
â”‚   â”‚  â”œâ”€ models/                    # Global interfaces & class models (DTOs / ViewModels)
â”‚   â”‚  â”œâ”€ constants/                 # App constants (routes, limits, roles, feature flags)
â”‚   â”‚  â”œâ”€ enums/                     # Global TypeScript enums
â”‚   â”‚  â”œâ”€ helpers/                   # Pure utility/helper functions (dates, formatters)
â”‚   â”‚  â”œâ”€ guards/                    # Auth/role guards for route protection
â”‚   â”‚  â”œâ”€ interceptors/              # HTTP interceptors (auth, error, base URL)
â”‚   â”‚  â””â”€ config/                    # DI tokens & environment adapters (runtime config)
â”‚   â”‚
â”‚   â”œâ”€ shared/                       # Reusable, generic building blocks (no business logic)
â”‚   â”‚  â”œâ”€ pipes/                     # Pure pipes (currency, i18n helpers, safeHtml, etc.)
â”‚   â”‚  â”œâ”€ directives/                # Attribute/structural directives (focus, mask, etc.)
â”‚   â”‚  â”œâ”€ components/                # Dumb/presentational components only
â”‚   â”‚  â”‚  â”œâ”€ ui/                     # Buttons, inputs, tables, modals, empty-states
â”‚   â”‚  â”‚  â””â”€ layout/                 # Header, sidebar, breadcrumbs, shell widgets
â”‚   â”‚  â””â”€ utils/                     # Reusable helpers (pagination calc, validators)
â”‚   â”‚
â”‚   â”œâ”€ components/                   # Feature pages grouped by domain/role
â”‚   â”‚  â”œâ”€ patient/                   # Patient-facing features
â”‚   â”‚  â”‚  â”œâ”€ dashboard/              # View/download appointment PDFs (read-only)
â”‚   â”‚  â”‚  â”œâ”€ services/               # Services catalog + "generate ticket" flow
â”‚   â”‚  â”‚  â”œâ”€ payments/               # Tickets list (pending/paid/expired)
â”‚   â”‚  â”‚  â”œâ”€ health-card/            # Request/view health card certificates
â”‚   â”‚  â”‚  â”œâ”€ profile/                # Personal data (change password only)
â”‚   â”‚  â”‚  â””â”€ patient.routes.ts       # Lazy sub-routes for patient domain
â”‚   â”‚  â”œâ”€ medical/                   # Clinician features (doctor/nurse/etc.)
â”‚   â”‚  â”‚  â”œâ”€ dashboard/              # KPIs + last two PDFs generated by this clinician
â”‚   â”‚  â”‚  â”œâ”€ consultations/          # Create encounter with before-submit summary
â”‚   â”‚  â”‚  â”œâ”€ appointments/           # Search patients and view/download PDFs
â”‚   â”‚  â”‚  â”œâ”€ services/               # Services available for clinician's specialty
â”‚   â”‚  â”‚  â”œâ”€ payments/               # Ticket status by patient (search)
â”‚   â”‚  â”‚  â”œâ”€ attended/               # Quick access to attended patients (paginated)
â”‚   â”‚  â”‚  â””â”€ profile/                # Professional profile (read-only)
â”‚   â”‚  â”‚  â””â”€ medical.routes.ts       # Lazy sub-routes for medical domain
â”‚   â”‚  â””â”€ admin/                     # Administrative features
â”‚   â”‚     â”œâ”€ dashboard/              # KPIs: users, encounters, tickets, services
â”‚   â”‚     â”œâ”€ consultations/          # Audit any encounter (search + read-only)
â”‚   â”‚     â”œâ”€ appointments/           # All attended appointments (paginated + search)
â”‚   â”‚     â”œâ”€ services/               # Create/edit/delete services (CRUD)
â”‚   â”‚     â”œâ”€ payments/               # View/audit all tickets
â”‚   â”‚     â”œâ”€ users/                  # Manage accounts, promote to medical, assign specialty
â”‚   â”‚     â”œâ”€ templates/              # Medical templates and specialties management
â”‚   â”‚     â””â”€ profile/                # Admin personal data
â”‚   â”‚     â””â”€ admin.routes.ts         # Lazy sub-routes for admin domain
â”‚   â”‚
â”‚   â”œâ”€ app.routes.ts                 # Root routes (lazy-load each domain's sub-routes)
â”‚   â”œâ”€ app.config.ts                 # Root providers (provideRouter, HttpClient, interceptors)
â”‚   â”œâ”€ app.html                      # Root component template
â”‚   â”œâ”€ app.scss                      # Root component styles
â”‚   â”œâ”€ app.spec.ts                   # Root component tests
â”‚   â””â”€ app.ts                        # Root standalone component
â”‚
â”œâ”€ environments/                    # Environment files (used via DI tokens)
â”‚  â”œâ”€ environment.ts                # Dev/staging environment values
â”‚  â””â”€ environment.prod.ts           # Production environment values
â”‚
â”œâ”€ index.html                       # App host page
â”œâ”€ main.ts                          # bootstrapApplication(App, appConfig)
â””â”€ styles.scss                      # Global styles / Tailwind entry


---
Tables on database:

-- DB_name: db_center_medical   (PostgreSQL)

-- 1) Catalog base tables

CREATE TABLE sys_roles (
  sys_role_id     BIGSERIAL PRIMARY KEY,
  name_role       TEXT NOT NULL UNIQUE,
  created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
  -- Solo los valores definidos por ti:
  CONSTRAINT sys_roles_name_ck
    CHECK (name_role IN ('admin','medical','user'))
);

CREATE TABLE medical_template (
  medical_template_id BIGSERIAL PRIMARY KEY,
  name_template       VARCHAR(20) NOT NULL,
  template_structure  JSONB NOT NULL,
  created_at          DATE NOT NULL DEFAULT CURRENT_DATE
);

CREATE TABLE medical_roles (
  medical_role_id        BIGSERIAL PRIMARY KEY,
  specialty_name         TEXT NOT NULL UNIQUE,
  p_medical_template_id  BIGINT REFERENCES medical_template(medical_template_id) ON UPDATE CASCADE ON DELETE SET NULL,
  created_at             TIMESTAMPTZ NOT NULL DEFAULT now(),
  -- Solo los valores definidos por ti:
  CONSTRAINT medical_roles_specialty_ck
    CHECK (specialty_name IN ('doctor','obstetrician','dentist','psychologist','nurse'))
);

-- 2) Users

CREATE TABLE users (
  user_id            BIGSERIAL PRIMARY KEY,
  dni                VARCHAR(8) UNIQUE CHECK (dni ~ '^[0-9]{1,8}$') NOT NULL,
  email              TEXT UNIQUE NOT NULL,
  password           TEXT NOT NULL,
  p_sys_role_id      BIGINT NOT NULL REFERENCES sys_roles(sys_role_id) ON UPDATE CASCADE
                        DEFAULT (
                          (SELECT sys_role_id FROM sys_roles WHERE name_role = 'user')
                        ),
  p_medical_role_id  BIGINT REFERENCES medical_roles(medical_role_id) ON UPDATE CASCADE ON DELETE SET NULL,
  created_at         TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX users_role_idx ON users(p_sys_role_id);
CREATE INDEX users_medrole_idx ON users(p_medical_role_id);

-- 3) encounters 

CREATE TABLE encounters (
  encounters_id  BIGSERIAL PRIMARY KEY,
  provider_id    BIGINT NOT NULL REFERENCES users(user_id) ON UPDATE CASCADE,  -- mÃ©dico u otro proveedor
  patient_id     BIGINT NOT NULL REFERENCES users(user_id) ON UPDATE CASCADE,  -- paciente
  created_at     TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX encounters_provider_idx ON encounters(provider_id);
CREATE INDEX encounters_patient_idx  ON encounters(patient_id);

-- 4) Clinic forms

-- 4.1) Doctor, nurse, psychologist diagnoses form
CREATE TABLE form_meobps (
  form_meobps_id   BIGSERIAL PRIMARY KEY,
  fecha            DATE,
  hora             TIME,
  edad             TEXT,
  tiem_enfermedad  TEXT,
  mot_consulta     TEXT,
  apetito          TEXT,
  sed              TEXT,
  suenio           TEXT,
  animo            TEXT,
  orina            TEXT,
  deposiciones     TEXT,
  temperatura      NUMERIC,  
  pa               TEXT,
  mmhg_fc          TEXT,
  fr               TEXT,
  peso             NUMERIC,
  talla            NUMERIC,
  imc              NUMERIC,
  so               TEXT,
  diagnostico      TEXT,
  ex_auxiliares    TEXT,
  referencia       TEXT,
  prox_cita        DATE,
  firma_sello      TEXT,
  colegio_prof     TEXT,
  observacion      TEXT,
  p_encounters_id  BIGINT NOT NULL REFERENCES encounters(encounters_id) ON UPDATE CASCADE ON DELETE CASCADE,
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX form_meobps_encounter_idx ON form_meobps(p_encounters_id);

-- 4.2) Dentist diagnoses form
CREATE TABLE form_dentist (
  form_dentist_id       BIGSERIAL PRIMARY KEY,
  apell_nombres         TEXT,
  h_c_l                 TEXT,
  fecha                 DATE,
  edad                  TEXT,
  sexo                   VARCHAR(1) CHECK (sexo IN ('M','F')),
  acompaniante          TEXT,
  reac_medicamento      TEXT,
  ant_patologicos       TEXT,
  piez_cardiaca         TEXT,
  piez_perdida          TEXT,
  piez_obturada         TEXT,
  uso_cepillo           TEXT,
  pla_blada             TEXT,
  pla_calcificada       TEXT,
  estado_higiene        TEXT,
  ries_estomatologico   TEXT,
  diag_final            TEXT,
  trat_efe_fecha        TEXT,
  trat_efe_procedimiento TEXT,
  trat_efe_tratamiento  TEXT,
  trat_efe_firm_sello   TEXT,
  p_encounters_id       BIGINT NOT NULL REFERENCES encounters(encounters_id) ON UPDATE CASCADE ON DELETE CASCADE,
  created_at            TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX form_dentist_encounter_idx ON form_dentist(p_encounters_id);

-- 5) services and tickets

CREATE TABLE services (
  service_id        BIGSERIAL PRIMARY KEY,
  service_name      TEXT NOT NULL,
  service_code      TEXT,
  price             NUMERIC(12,2) NOT NULL DEFAULT 0,
  p_medical_role_id BIGINT REFERENCES medical_roles(medical_role_id) ON UPDATE CASCADE ON DELETE SET NULL,
  created_at        TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX services_medrole_idx ON services(p_medical_role_id);

CREATE TABLE payment_ticket (
  ticket_id    BIGSERIAL PRIMARY KEY,
  amount       NUMERIC(12,2) NOT NULL CHECK (amount >= 0),
  status       VARCHAR(10) NOT NULL CHECK (status IN ('pending','paid','expired')),
  p_user_id    BIGINT NOT NULL REFERENCES users(user_id) ON UPDATE CASCADE,
  p_service_id BIGINT NOT NULL REFERENCES services(service_id) ON UPDATE CASCADE,
  created_at   TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX payment_ticket_user_idx    ON payment_ticket(p_user_id);
CREATE INDEX payment_ticket_service_idx ON payment_ticket(p_service_id);
CREATE INDEX payment_ticket_status_idx  ON payment_ticket(status);

-- 6) Medical card (no required a medical)

CREATE TABLE medical_card (
  medical_card_id BIGSERIAL PRIMARY KEY,
  age             TEXT,
  marital_status  TEXT,
  level_education TEXT,
  work_place      TEXT,
  area            TEXT,
  blood_group     VARCHAR(3) CHECK (blood_group IN ('A+','A-','B+','B-','AB+','AB-','O+','O-')),
  clinical_history TEXT,
  care_date       TIMESTAMPTZ,
  expiration_date TIMESTAMPTZ,
  p_user_id       BIGINT NOT NULL REFERENCES users(user_id) ON UPDATE CASCADE ON DELETE CASCADE,
  result_stool    TEXT,
  status          VARCHAR(10) NOT NULL CHECK (status IN ('pending','paid')),
  created_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX medical_card_user_idx   ON medical_card(p_user_id);
CREATE INDEX medical_card_status_idx ON medical_card(status);
---
Ahora que conoces el funcionamiento de mi sistema quiero que modifiques en la estructura de folders y archivos que me propusiste. 1, Actua como un desarrollador experto en sistemas, y da una descripcion de lo que hace o sirve cada folder y para cada archivo dar un contexto de lo que debe contener o se busca que contenga. 2, Actua como un experto en backend y conociendo mi sistema, quiero que me generes y resumen breve y preciso de que servicios (DTOS, CRUD's, APIS, 